@using Domain.Interfaces
@using Domain.Models
@model IEnumerable<IItemValidating>

@{
    ViewData["Title"] = "Preview Imported Items";

    var restaurants = Model.OfType<Restaurant>().ToList();
    var restaurantNameByImportId = restaurants
        .Where(r => !string.IsNullOrWhiteSpace(r.ImportId))
        .GroupBy(r => r.ImportId.Trim())
        .ToDictionary(g => g.Key, g => g.First().Name);
}

<h2>Preview Imported Items</h2>

<table class="table">
    <thead>
        <tr>
            <th>Type</th>
            <th>Name / Title</th>
            <th>Owner / Restaurant</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            if (item is Restaurant r)
            {
                <tr>
                    <td>Restaurant</td>
                    <td>@r.Name</td>
                    <td>@r.OwnerEmailAddress</td>
                    <td>@r.Status</td>
                </tr>
            }
            else if (item is MenuItem m)
            {
                var importKey = m.RestaurantImportId?.Trim() ?? "";
                var restaurantName = restaurantNameByImportId.TryGetValue(importKey, out var name)
                ? name
                : "";

                <tr>
                    <td>Menu Item</td>
                    <td>@m.Title</td>
                    <td>@restaurantName</td>
                    <td>@m.Status</td>
                </tr>
            }
        }
    </tbody>
</table>

<hr />

<h3>Step 2: Upload Images ZIP and Commit</h3>

<form asp-action="Commit" asp-controller="BulkImport" method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label class="form-label">Images ZIP</label>
        <input type="file" name="imagesZip" class="form-control" accept=".zip" />
    </div>

    <button type="submit" class="btn btn-success">Upload Images &amp; Commit</button>
</form>

<p>
    <a asp-action="DownloadTemplateZip" asp-controller="BulkImport" class="btn btn-secondary">
        Download Images ZIP Template
    </a>
</p>
